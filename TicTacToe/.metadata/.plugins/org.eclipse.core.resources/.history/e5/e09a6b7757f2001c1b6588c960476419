package com.springboot.app.game.service;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import org.slf4j.Logger;
import org.slf4j.LoggerFactory;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.springboot.app.game.clients.BoardClientRest;
import com.springboot.app.game.clients.CoordinateClientRest;
import com.springboot.app.game.clients.PlayerClientRest;
import com.springboot.app.game.dto.BoardDto;
import com.springboot.app.game.dto.CoordinateDto;
import com.springboot.app.game.dto.GameDto;
import com.springboot.app.game.dto.PlayerDto;
import com.springboot.app.game.entities.GameEntity;
import com.springboot.app.game.repository.GameRepository;


@Service
public class GameService implements IGameService {
		
	@Autowired
	private PlayerClientRest playerClientRest;
	
	@Autowired
	private BoardClientRest boardClientRest;
	
	@Autowired
	private CoordinateClientRest coordinateClientRest;
	
	@Autowired
	private GameRepository gameRepository;
	
	private static GameEntity game = new GameEntity();


	@Override
	public GameEntity create(String username_1, String username_2) {
		game.setPlayer_id_1(playerClientRest.getIdByUsername(username_1));
		game.setPlayer_id_2(playerClientRest.getIdByUsername(username_2));
		game.setBoard_id(boardClientRest.createBoardAndGetId());
		gameRepository.save(game);
		return game;
	}

	@Override
	public GameDto getGame() {
		GameDto gameDto = new GameDto();
		BoardDto boardDto = boardClientRest.getBoardById(game.getBoard_id());
		gameDto.setBoard(boardDto);
		gameDto.setPlayer_1(playerClientRest.getPlayerById(game.getPlayer_id_1()));
		gameDto.setPlayer_2(playerClientRest.getPlayerById(game.getPlayer_id_2()));
		return gameDto;
	}

	@Override
	public void put(String username, CoordinateDto target) {
		CoordinateDto coordinateDto = target;
		Integer playerId = playerClientRest.getIdByUsername(username);
		GameEntity gameEntity = gameRepository.findByPlayerId(playerId);
		coordinateDto.setPlayer_id(playerId);
		coordinateDto.setBoard_id(gameEntity.getBoard_id());
		coordinateClientRest.create(coordinateDto);
		
	}

}
